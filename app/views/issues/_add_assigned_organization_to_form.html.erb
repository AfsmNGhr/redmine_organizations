<%= label :issue_assigned_to_id, l(:field_assigned_to) %>
<%= select_tag :assigned_organization_to_id,
               options_for_select(@issue.project.organizations.map{ |o| [o.fullname, o.id]}, @issue.assigned_to.try(:organization).try(:id)),
               :onchange => "updateAssignedToSelect($('#assigned_organization_to_id').val())",
               :include_blank => true, disabled: false %>
<BR/>
<%= f.select :assigned_to_id, principals_options_for_select_with_organizations_data(@issue.assignable_users, @issue.assigned_to),
             {:label => '', :include_blank => true, :required => @issue.required_attribute?('assigned_to_id')},
             :onchange => "updateIssueFrom('#{escape_javascript project_issue_form_path(@project, :id => @issue, :format => 'js')}')"
%>

<script type="text/javascript" charset="utf-8">

  function updateAssignedToSelect(organization_id) {
    $('#issue_assigned_to_id option').each(function(){
      if ($(this).data('organization') != organization_id && $(this).data('organization') != undefined && organization_id != ''){
        $(this).attr('disabled','disabled');
      }else{
        $(this).removeAttr('disabled');
      }
    });
    $('#issue_assigned_to_id option:selected').each(function(){
      if ($(this).data('organization') != organization_id){
        $(this).prop("selected", false);
      }
    });
  }
</script>
